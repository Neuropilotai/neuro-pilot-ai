<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Owner Super Console | NeuroInnovate Inventory v3.2.0</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/public/css/owner-super.css">
</head>
<body>
  <header>
    <div class="logo">
      🧠 NeuroPilot v14.4.0 • The Living Inventory Intelligence Console
      <span id="liveBadge" class="badge badge-live">
        LIVE 🟢
      </span>
      <span class="badge badge-version">
        SUPER • data:/api/owner/dashboard
      </span>
    </div>
    <div class="user-info">
      <span id="currentUser"></span>
      <span class="token-ttl" id="tokenTTL"></span>
      <button type="button" class="btn btn-sm btn-secondary" onclick="logout()">Logout</button>
    </div>
  </header>

  <nav class="tabs">
    <div class="tab active" onclick="switchTab('dashboard')">📊 Dashboard</div>
    <div class="tab" onclick="switchTab('inventory')">📦 Inventory</div>
    <div class="tab" onclick="switchTab('locations')">📍 Locations</div>
    <div class="tab" onclick="switchTab('pdfs')">📄 Orders/PDFs</div>
    <div class="tab" onclick="switchTab('count')">🔢 Count</div>
    <div class="tab" onclick="switchTab('playground')">🎮 Playground</div>
    <div class="tab" onclick="switchTab('ai')">🤖 AI Console</div>
    <div class="tab" onclick="switchTab('forecast')">📈 Forecast</div>
    <div class="tab" onclick="switchTab('menu')">🍽️ Menu</div>
    <div class="tab" onclick="switchTab('reports')">📋 Reports</div>
    <div class="tab" onclick="switchTab('settings')">⚙️ Settings</div>
  </nav>

  <div class="container content">
    <!-- Dashboard Tab -->
    <div id="dashboard" class="tab-panel active">
      <!-- v13.0: Cognitive Overview -->
      <div class="card card-cognitive">
        <div class="card-header">
          <h3 class="card-title">🧠 Cognitive Overview - AI Intelligence Status</h3>
          <button type="button" class="btn btn-sm btn-cognitive-refresh" onclick="loadCognitiveIntelligence()">↻ Refresh</button>
        </div>
        <div class="cognitive-grid">
          <!-- v14.4: AI Intelligence Index - Featured -->
          <div class="cognitive-main-stat">
            <div class="cognitive-main-value" id="aiIntelligenceIndex">--</div>
            <div class="cognitive-main-label">🧠 AI Intelligence Index</div>
            <div class="cognitive-main-trend" id="aiIndexTrend">--</div>
          </div>
          <div class="cognitive-stat">
            <div class="cognitive-stat-value" id="aiConfidenceAvg">--</div>
            <div class="cognitive-stat-label">AI Confidence</div>
          </div>
          <div class="cognitive-stat">
            <div class="cognitive-stat-value" id="forecastAccuracyAvg">--</div>
            <div class="cognitive-stat-label">Forecast Accuracy</div>
          </div>
          <div class="cognitive-stat">
            <div class="cognitive-stat-value" id="activeModulesCount">--</div>
            <div class="cognitive-stat-label">Active Modules</div>
          </div>
          <div class="cognitive-stat">
            <div class="cognitive-stat-value" id="learningAppliedCount">--</div>
            <div class="cognitive-stat-label">Learning (7d)</div>
          </div>
        </div>
        <div id="cognitiveCharts"></div>
      </div>

      <!-- Original Stats -->
      <div class="grid grid-4">
        <div class="card stat-card">
          <div class="stat-value" id="systemHealth">--</div>
          <div class="stat-label">System Health</div>
        </div>
        <div class="card stat-card cursor-pointer" onclick="showForecastDetail()" title="Click to see details">
          <div class="stat-value" id="forecastCoverage">--</div>
          <div class="stat-label">Forecast Coverage</div>
        </div>
        <div class="card stat-card cursor-pointer" onclick="showStockoutDetail()" title="Click to see details">
          <div class="stat-value" id="stockoutCount">--</div>
          <div class="stat-label">Stockout Risk</div>
        </div>
        <div class="card stat-card">
          <div class="stat-value" id="lastAIRun">--</div>
          <div class="stat-label">Last AI Training</div>
        </div>
      </div>

      <!-- v13.0: AI Activity Feed -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📡 Live AI Activity Feed</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadActivityFeed()">↻ Refresh</button>
        </div>
        <div id="activityFeed"></div>
      </div>

      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Database Statistics</h3>
          </div>
          <div id="dbStats"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Recent Activity</h3>
          </div>
          <div id="recentActivity"></div>
        </div>
      </div>
    </div>

    <!-- Inventory Tab -->
    <div id="inventory" class="tab-panel">
      <div class="card">
        <div class="toolbar">
          <input type="text" class="input toolbar-search" id="inventorySearch" placeholder="Search items...">
          <button type="button" class="btn btn-primary" onclick="loadInventory()">🔍 Search</button>
          <button type="button" class="btn btn-secondary" onclick="openSpotCheckModal()">📋 Spot Check</button>
        </div>
        <div id="inventoryTable"></div>
      </div>
    </div>

    <!-- Locations Tab -->
    <div id="locations" class="tab-panel">
      <div class="grid grid-3">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Storage Locations</h3>
            <div class="flex-gap-half">
              <button type="button" class="btn btn-sm btn-success" onclick="openAddLocationModal()">➕ Add New</button>
              <button type="button" class="btn btn-sm btn-primary" onclick="loadLocations()">↻ Refresh</button>
            </div>
          </div>
          <div id="locationsList"></div>
        </div>
        <div class="card grid-col-span-2">
          <div class="card-header">
            <h3 class="card-title">Items at Location</h3>
            <span id="selectedLocation"></span>
          </div>
          <div id="locationItems"></div>
        </div>
      </div>

      <!-- Unassigned Items Panel -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📦 Unassigned Items</h3>
          <div class="flex-gap-half">
            <button type="button" class="btn btn-sm btn-success" onclick="assignSelectedItems()" id="assignSelectedBtn" disabled>📍 Assign Selected</button>
            <button type="button" class="btn btn-sm btn-primary" onclick="loadUnassignedItems()">↻ Refresh</button>
          </div>
        </div>
        <div class="toolbar">
          <input type="text" class="input toolbar-search" id="unassignedSearch" placeholder="Search items..." oninput="debounceUnassignedSearch()">
          <span class="text-light-med">
            Total: <strong id="unassignedTotal">--</strong>
          </span>
        </div>
        <div>
          <table class="table">
            <thead>
              <tr>
                <th>
                  <input type="checkbox" id="selectAllUnassigned" onchange="toggleSelectAllUnassigned()">
                </th>
                <th>Item Code</th>
                <th>Name</th>
                <th>Unit</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="unassignedList"></tbody>
          </table>
        </div>
        <div class="pagination" id="unassignedPagination"></div>
      </div>
    </div>

    <!-- PDFs Tab -->
    <div id="pdfs" class="tab-panel">
      <div class="card">
        <div class="toolbar">
          <input type="text" class="input toolbar-search" id="pdfSearch" placeholder="Search invoice number...">
          <select class="select" id="pdfStatus" onchange="loadPDFs()">
            <option value="all">All PDFs</option>
            <option value="unprocessed">Unprocessed</option>
            <option value="processed">Processed</option>
          </select>
          <button type="button" class="btn btn-primary" onclick="loadPDFs()">🔍 Search</button>
          <button type="button" class="btn btn-success" onclick="openUploadPDFModal()">📤 Upload PDF</button>
          <button type="button" class="btn btn-success" onclick="openIncludeOrdersModal()">✓ Include in Count</button>
        </div>
        <div id="pdfTable"></div>
      </div>
    </div>

    <!-- Count Tab -->
    <div id="count" class="tab-panel">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Start New Count</h3>
          </div>
          <div class="form-group">
            <label class="form-label">Location (optional)</label>
            <select class="select" id="countLocation">
              <option value="">Select location...</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea class="textarea" id="countNotes" placeholder="Count notes..."></textarea>
          </div>
          <button type="button" class="btn btn-primary" onclick="startCount()">🎯 Start Count</button>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Active Count</h3>
            <span id="activeCountId"></span>
          </div>
          <div id="activeCountDetails"></div>
        </div>
      </div>
      <div class="card" id="countProcessPanel">
        <div class="card-header">
          <h3 class="card-title">Count Process Panel</h3>
        </div>
        <div id="countProcessDetails"></div>
      </div>
    </div>

    <!-- Playground Tab (Month-End Workflow - v14.1) -->
    <div id="playground" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">🎮 Month-End Playground - Workspace Manager</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadPlayground()">↻ Refresh</button>
        </div>
        <div class="alert alert-info">
          <strong>Month-End Workflow:</strong> Create workspaces, attach invoices, count inventory across locations, and generate usage reports.
        </div>
        <div id="playgroundPanel"></div>
      </div>
    </div>

    <!-- AI Console Tab -->
    <div id="ai" class="tab-panel">
      <!-- AI Ops System Health Panel (v13.5) -->
      <div class="card card-bordered">
        <div class="card-header">
          <h3 class="card-title">🚀 AI Ops System Health (v13.5 Adaptive)</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadAIOpsStatus()">↻ Refresh</button>
        </div>
        <div class="grid grid-4" id="aiOpsHealthGrid">
          <div class="stat-card">
            <div class="stat-value" id="opsHealthScore">--</div>
            <div class="stat-label">Health Score</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="opsDQIScore">--</div>
            <div class="stat-label">🧮 Data Quality (DQI)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="opsForecastLatency">--</div>
            <div class="stat-label">⚙️ Forecast Latency</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="opsLearningDivergence">--</div>
            <div class="stat-label">🧩 Learning Divergence</div>
          </div>
        </div>
        <div id="aiOpsChecks"></div>
      </div>

      <!-- Cron Schedule Summary (v12.5) -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">⏰ Autonomous Cron Schedule</h3>
          <button type="button" class="btn btn-sm btn-secondary" onclick="triggerJob('ai_forecast')">▶️ Run Forecast Now</button>
          <button type="button" class="btn btn-sm btn-secondary" onclick="triggerJob('ai_learning')">▶️ Run Learning Now</button>
        </div>
        <div class="grid grid-2" id="cronSchedule">
          <div>
            <strong>🔮 Daily Forecast (06:00)</strong>
            <div id="forecastLastRun" class="text-light-med-mt">Last: --</div>
            <div id="forecastNextRun" class="text-light-med">Next: --</div>
          </div>
          <div>
            <strong>🧠 Daily Learning (21:00)</strong>
            <div id="learningLastRun" class="text-light-med-mt">Last: --</div>
            <div id="learningNextRun" class="text-light-med">Next: --</div>
          </div>
        </div>
      </div>

      <!-- Learning Timeline (v12.5) -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">📚 Learning Timeline (Last 10 Insights)</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadLearningTimeline()">↻ Refresh</button>
        </div>
        <div id="learningTimeline"></div>
      </div>

      <div class="grid grid-3">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Reorder Recommendations</h3>
            <button type="button" class="btn btn-sm btn-primary" onclick="loadAIReorder()">↻</button>
          </div>
          <div id="aiReorderList"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Anomaly Watchlist</h3>
            <button type="button" class="btn btn-sm btn-primary" onclick="loadAIAnomalies()">↻</button>
          </div>
          <div id="aiAnomalyList"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Upgrade Advisor</h3>
            <button type="button" class="btn btn-sm btn-primary" onclick="loadAIUpgrade()">↻</button>
          </div>
          <div id="aiUpgradeAdvice"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Owner Feedback & Training</h3>
        </div>
        <div class="form-group">
          <textarea class="textarea" id="aiFeedback" placeholder="Enter feedback (e.g., 'coffee 1.5 cups/person', 'eggs 2 per person for breakfast')"></textarea>
        </div>
        <div class="flex-gap-1">
          <button type="button" class="btn btn-primary" onclick="submitFeedback()">💬 Submit Feedback</button>
          <button type="button" class="btn btn-success" onclick="trainAI()">🚀 Train Now</button>
          <button type="button" class="btn btn-secondary" onclick="loadFeedbackHistory()">📜 History</button>
        </div>
        <div id="feedbackHistory"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">AI Learning Nudge</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadLearningNudges()">↻ Refresh</button>
        </div>
        <div id="learningNudges"></div>
      </div>
    </div>

    <!-- Forecast Tab -->
    <div id="forecast" class="tab-panel">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Population Controls</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadPopulation()">↻</button>
        </div>
        <div class="flex-gap-1-wrap">
          <div>
            <label class="form-label">Total Population</label>
            <input type="number" class="input" id="totalPopulation">
          </div>
          <div>
            <label class="form-label">Indian Meals</label>
            <input type="number" class="input" id="indianCount">
          </div>
          <button type="button" class="btn btn-primary" onclick="updatePopulation()">💾 Update</button>
          <div class="chip" onclick="adjustPopulation(25, 0)">+25 People</div>
          <div class="chip" onclick="adjustPopulation(-25, 0)">-25 People</div>
          <div class="chip" onclick="adjustPopulation(0, 5)">+5 Indian</div>
          <div class="chip" onclick="adjustPopulation(0, -5)">-5 Indian</div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Stockout Alerts</h3>
        </div>
        <div id="stockoutAlerts"></div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Today's Predictions</h3>
          <button type="button" class="btn btn-sm btn-primary" onclick="loadDailyForecast()">↻ Refresh</button>
        </div>
        <div id="forecastTable"></div>
      </div>
    </div>

    <!-- Menu Tab (v14.4.2) -->
    <div id="menu" class="tab-panel">
      <!-- Menu Controls -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">🍽️ 4-Week Menu Calendar (280 ppl)</h3>
          <div class="flex-gap-half">
            <button type="button" class="btn btn-sm btn-primary" id="menuRefreshBtn">↻ Refresh</button>
            <button type="button" class="btn btn-sm btn-success" id="menuHeadcountBtn">👥 Headcount</button>
            <button type="button" class="btn btn-sm btn-secondary" id="menuShoppingListBtn">🛒 Shopping List</button>
          </div>
        </div>

        <!-- Week Selector -->
        <div class="menu-week-selector">
          <button type="button" class="btn btn-sm menu-week-btn active" data-week="1">Week 1</button>
          <button type="button" class="btn btn-sm menu-week-btn" data-week="2">Week 2</button>
          <button type="button" class="btn btn-sm menu-week-btn" data-week="3">Week 3</button>
          <button type="button" class="btn btn-sm menu-week-btn" data-week="4">Week 4</button>
          <span class="menu-current-week-badge" id="menuCurrentWeekBadge"></span>
        </div>

        <!-- Week Info Banner -->
        <div class="menu-week-info" id="menuWeekInfo">
          <div class="menu-week-dates">
            <span id="menuWeekDates">Loading...</span>
          </div>
          <div class="menu-week-headcount">
            <strong id="menuHeadcountDisplay">280</strong> people
          </div>
        </div>

        <!-- Calendar Grid (7 days: Wed→Tue) -->
        <div class="menu-calendar-grid" id="menuCalendar">
          <div class="loading"><div class="spinner"></div> Loading menu calendar...</div>
        </div>
      </div>

      <!-- 19:30 Policy Banner -->
      <div class="alert alert-warning menu-policy-banner" id="menuPolicyBanner">
        ⚠️ <strong>19:30 Policy:</strong> Menu changes are locked until 19:30. Portion target: 650g/person.
        Drift threshold: ±15%.
      </div>
    </div>

    <!-- Reports Tab -->
    <div id="reports" class="tab-panel">
      <!-- GFS Monthly Reports Quick Access -->
      <div class="card card-cognitive">
        <div class="card-header">
          <h3 class="card-title">📊 GFS Monthly Accounting Reports</h3>
          <span class="badge btn-cognitive-refresh">181 Invoices | $2.13M</span>
        </div>
        <div>
          <p>
            Access all monthly GFS accounting reports (Jan-Sep 2025) with clickable PDF links, cost code breakdowns, and copy/paste ready format.
          </p>
          <button type="button" class="btn btn-white-full" onclick="openGFSReports()">
            🚀 Open GFS Monthly Reports Dashboard
          </button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Tiered Reporting Center</h3>
        </div>
        <div class="flex-gap-half-wrap">
          <div class="chip active" id="reportTab-executive" onclick="switchReportTab('executive')">👔 Executive</div>
          <div class="chip" id="reportTab-ops" onclick="switchReportTab('ops')">📊 Ops Manager</div>
          <div class="chip" id="reportTab-production" onclick="switchReportTab('production')">👨‍🍳 Production</div>
          <div class="chip" id="reportTab-purchasing" onclick="switchReportTab('purchasing')">🛒 Purchasing</div>
          <div class="chip" id="reportTab-finance" onclick="switchReportTab('finance')">💰 Finance</div>
        </div>
        <button type="button" class="btn btn-secondary" onclick="exportCurrentReport()">📥 Export CSV</button>
        <div id="reportContent"></div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div id="settings" class="tab-panel">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Device Binding</h3>
          </div>
          <div id="deviceInfo"></div>
          <button type="button" class="btn btn-primary" onclick="rebindDevice()">🔐 Rebind Device</button>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Console Preferences</h3>
          </div>
          <div class="form-group">
            <label class="flex-align-center">
              <input type="checkbox" id="warmCache">
              <span>Warm Forecast Cache on Load</span>
            </label>
          </div>
          <button type="button" class="btn btn-secondary" onclick="exportDailyCSV()">📥 Export Daily Summary CSV</button>
        </div>
      </div>
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">System Orchestration</h3>
          </div>
          <button type="button" class="btn btn-success" onclick="orchestrateStart()">🚀 Start All Services</button>
          <button type="button" class="btn btn-warning" onclick="orchestrateStop()">🛑 Stop All Services (Safe)</button>
          <div id="orchestrationStatus"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Backup & Recovery</h3>
          </div>
          <button type="button" class="btn btn-primary" onclick="createRecoveryKit()">💾 Create Recovery Kit</button>
          <button type="button" class="btn btn-secondary" onclick="verifyRecoveryKit()">🔍 Verify Recovery Kit</button>
          <button type="button" class="btn btn-secondary" onclick="dryRunRestore()">🔄 Dry-Run Restore</button>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Audit Chain</h3>
        </div>
        <div id="auditInfo"></div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="pdfModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="pdfModalTitle">PDF Viewer</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closePDFModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <iframe id="pdfFrame"></iframe>
      </div>
    </div>
  </div>

  <div id="includeOrdersModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Include PDFs in Count</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeIncludeOrdersModal()">✕</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          Select PDFs to include in the month-end count. Only unprocessed PDFs are shown.
        </div>
        <div class="form-group">
          <label class="form-label">Count ID</label>
          <input type="text" class="input" id="includeCountId" placeholder="Enter count ID">
        </div>
        <div class="checkbox-list" id="pdfCheckboxList"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeIncludeOrdersModal()">Cancel</button>
        <button type="button" class="btn btn-success" onclick="includeSelectedPDFs()">✓ Include Selected</button>
      </div>
    </div>
  </div>

  <div id="orchestrationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="orchestrationModalTitle">System Orchestration</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeOrchestrationModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="orchestrationSteps"></div>
        <div id="orchestrationCurl"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeOrchestrationModal()">Close</button>
      </div>
    </div>
  </div>

  <div id="recoveryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="recoveryModalTitle">Recovery Operation</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeRecoveryModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="recoveryDetails"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeRecoveryModal()">Close</button>
      </div>
    </div>
  </div>

  <div id="recoveryInputModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="recoveryInputModalTitle">Recovery Input</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeRecoveryInputModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <form id="recoveryInputForm" onsubmit="event.preventDefault(); submitRecoveryInput();">
          <div class="form-group">
            <label class="form-label" id="recoveryInputLabel">Path to Recovery Kit</label>
            <input type="text" class="input" id="recoveryPath" placeholder="/path/to/recovery_kit.tar.gz.enc" autocomplete="off">
          </div>
          <div class="form-group">
            <label class="form-label">Passphrase (min 12 characters)</label>
            <input type="password" class="input" id="recoveryPassphrase" placeholder="Enter passphrase" autocomplete="current-password">
          </div>
          <div class="form-group hidden" id="recoveryDestGroup">
            <label class="form-label">Destination Path (USB)</label>
            <input type="text" class="input" id="recoveryDest" placeholder="/Volumes/USB/backup" autocomplete="off">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeRecoveryInputModal()">Cancel</button>
        <button type="button" class="btn btn-primary" id="recoveryInputSubmit" onclick="submitRecoveryInput()">Submit</button>
      </div>
    </div>
  </div>

  <!-- Forecast Coverage Detail Modal -->
  <div id="forecastDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>📈 Forecast Coverage Details</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeForecastDetailModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="forecastDetailContent"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeForecastDetailModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- Stockout Risk Detail Modal -->
  <div id="stockoutDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>⚠️ Stockout Risk Details</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeStockoutDetailModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="stockoutDetailContent"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeStockoutDetailModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- PDF Upload Modal -->
  <div id="uploadPDFModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Upload PDF Invoice</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeUploadPDFModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <form id="uploadPDFForm" onsubmit="event.preventDefault(); uploadPDF();">
          <div class="form-group">
            <label class="form-label">Select PDF File *</label>
            <input type="file" class="input" id="pdfFile" accept="application/pdf" required>
            <small class="text-light-small">Max size: 50MB. Only PDF files are allowed.</small>
          </div>
          <div class="form-group">
            <label class="form-label">Notes (optional)</label>
            <textarea class="textarea" id="pdfNotes" placeholder="e.g., GFS invoice, weekly order, etc."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeUploadPDFModal()">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="uploadPDF()">📤 Upload</button>
      </div>
    </div>
  </div>

  <!-- Location Create/Edit Modal -->
  <div id="locationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="locationModalTitle">Add New Location</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeLocationModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <form id="locationForm" onsubmit="event.preventDefault(); saveLocation();">
          <input type="hidden" id="locationEditCode">
          <div class="form-group">
            <label class="form-label">Location ID *</label>
            <input type="text" class="input" id="locationCode" placeholder="e.g., cooler-01" required>
            <small class="text-light-small">Use lowercase with hyphens (e.g., "freezer-a2", "walk-in-d1")</small>
          </div>
          <div class="form-group">
            <label class="form-label">Location Name *</label>
            <input type="text" class="input" id="locationName" placeholder="e.g., Walk-in Freezer 1" required>
          </div>
          <div class="form-group">
            <label class="form-label">Type</label>
            <select class="select" id="locationType">
              <option value="warehouse">Warehouse</option>
              <option value="refrigerated">Refrigerated</option>
              <option value="frozen">Frozen</option>
              <option value="dry">Dry Storage</option>
              <option value="kitchen">Kitchen</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeLocationModal()">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="saveLocation()">💾 Save Location</button>
      </div>
    </div>
  </div>

  <!-- Add Item to Count Modal -->
  <div id="addItemToCountModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Item to Count</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeAddItemToCountModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <form id="addItemToCountForm" onsubmit="event.preventDefault(); submitItemToCount();">
          <!-- Item Search -->
          <div class="form-group">
            <label class="form-label">Search Item (by code or name) *</label>
            <input type="text" class="input" id="itemSearchInput" placeholder="Type item code or name..." autocomplete="off" required>
            <div id="itemSearchResults" class="hidden"></div>
            <input type="hidden" id="selectedItemCode">
            <div id="selectedItemDisplay" class="hidden">
              <strong>Selected:</strong> <span id="selectedItemText"></span>
              <button type="button" class="btn btn-sm btn-secondary btn-float-right" onclick="clearSelectedItem()">Clear</button>
            </div>
          </div>

          <!-- Storage Location -->
          <div class="form-group">
            <label class="form-label">Storage Location</label>
            <select class="select" id="countItemLocation">
              <option value="">Select location...</option>
            </select>
          </div>

          <!-- Quantity -->
          <div class="form-group">
            <label class="form-label">Quantity *</label>
            <input type="number" class="input" id="countItemQuantity" placeholder="0" step="0.01" min="0" required>
          </div>

          <!-- Notes -->
          <div class="form-group">
            <label class="form-label">Notes (optional)</label>
            <textarea class="textarea" id="countItemNotes" placeholder="Any notes about this item..."></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAddItemToCountModal()">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="submitItemToCount()">✓ Add Item</button>
      </div>
    </div>
  </div>

  <!-- Assign Locations Modal -->
  <div id="assignLocationsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Assign Items to Locations</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeAssignLocationsModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <strong id="assignItemsCount">0 items</strong> will be assigned to selected locations.
        </div>
        <div class="form-group">
          <label class="form-label">Select Locations (multiple) *</label>
          <select class="select" id="assignLocationSelect" multiple size="10">
            <!-- Populated dynamically -->
          </select>
          <small class="text-light-small">Hold Ctrl (Windows) or Cmd (Mac) to select multiple locations</small>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAssignLocationsModal()">Cancel</button>
        <button type="button" class="btn btn-success" onclick="confirmAssignLocations()">✓ Assign</button>
      </div>
    </div>
  </div>

  <!-- Workspace Details Modal (v14.3) -->
  <div id="workspaceModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="workspaceModalTitle">🎮 Workspace Details</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeWorkspaceModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="workspaceDetails">
          <div class="loading"><div class="spinner"></div> Loading workspace...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeWorkspaceModal()">Close</button>
        <button type="button" class="btn btn-primary hidden" id="workspaceUsageBtn" onclick="viewWorkspaceUsage()">📊 View Usage Report</button>
      </div>
    </div>
  </div>

  <!-- Recipe Drawer Modal (v14.4.2) -->
  <div id="recipeDrawerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="recipeDrawerTitle">Recipe Details</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeRecipeDrawer()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div id="recipeDrawerContent">
          <div class="loading"><div class="spinner"></div> Loading recipe...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeRecipeDrawer()">Close</button>
        <button type="button" class="btn btn-primary hidden" id="recipeEditBtn">Edit Recipe</button>
      </div>
    </div>
  </div>

  <!-- Headcount Adjustment Modal (v14.4.2) -->
  <div id="headcountModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>👥 Adjust Headcount</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeHeadcountModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          Changing headcount will automatically scale all recipe quantities and shopping lists.
        </div>
        <div class="form-group">
          <label class="form-label">Current Headcount</label>
          <div class="headcount-current-display">
            <span id="headcountCurrentDisplay">280</span> people
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">New Headcount *</label>
          <input type="number" class="input" id="headcountInput" placeholder="280" min="1" max="10000" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeHeadcountModal()">Cancel</button>
        <button type="button" class="btn btn-success" onclick="updateHeadcount()">💾 Update</button>
      </div>
    </div>
  </div>

  <!-- Shopping List Modal (v14.4.2) -->
  <div id="shoppingListModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🛒 Shopping List</h3>
        <button type="button" class="btn btn-sm btn-secondary" onclick="closeShoppingListModal()">✕ Close</button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info">
          <strong>Week <span id="shoppingWeekNum">1</span></strong> •
          <span id="shoppingWeekDates">Loading...</span> •
          <strong><span id="shoppingHeadcount">280</span> people</strong>
        </div>
        <div class="shopping-list-table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Item Code</th>
                <th>Description</th>
                <th>Total Qty</th>
                <th>Pack Size</th>
                <th>Packs Needed</th>
              </tr>
            </thead>
            <tbody id="shoppingListTable">
              <tr><td colspan="5" class="loading"><div class="spinner"></div> Loading...</td></tr>
            </tbody>
          </table>
        </div>
        <div id="shoppingListCSV" class="hidden"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeShoppingListModal()">Close</button>
        <button type="button" class="btn btn-primary" onclick="downloadShoppingListCSV()">📥 Download CSV</button>
      </div>
    </div>
  </div>

  <!-- v14.3: Shared Console Core (Zero Drift) -->
  <script src="owner-console-core.js?v=14.3.0"></script>

  <script src="owner-super-console.js?v=13.5.1"></script>
</body>
</html>
